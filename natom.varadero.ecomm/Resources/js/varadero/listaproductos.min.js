var ListaProductos={_domTable:null,_domTableTBODY:null,_currentFilters:null,_currentPage:1,_itemsPerPage:10,_totalPages:0,Init:function(n,t){ListaProductos._domTable=$($(".tblListaProductos")[0]);ListaProductos._domTableTBODY=$($(ListaProductos._domTable).find("tbody")[0]);n!==undefined&&(ListaProductos._currentPage=n);t!==undefined&&(ListaProductos._itemsPerPage=t);ListaProductos.Consultar();$("#btnAplicarFiltros").click(function(){var n=ListaProductos.ObtenerFiltrosDelModal();ListaProductos.ApplyFilters(n);$("#modalFiltroListaProducto").modal("hide")});$("#btnLimpiarFiltros").click(function(){$("#modalFiltroListaProducto input[type='text']").val("");$("#modalFiltroListaProducto input[type='checkbox']").removeAttr("checked");$("#btnAplicarFiltros").click()});var i=$("#EsCatalogo").length>0&&$("#EsCatalogo").val()=="True";i&&$("[hidden-para-catalogo]").hide();$("#modalFiltroListaProducto").on("shown.bs.modal",function(){setTimeout(function(){$($(".txtFiltroField")[0]).focus();$(".txtFiltroField").on("keyup",function(n){n.keyCode===13&&$("#btnAplicarFiltros").click()})},500)})},MostrarFiltros:function(){$("#modalFiltroListaProducto").modal("show");$("#txtFiltros").blur()},PaginaSiguiente:function(){ListaProductos._currentPage<ListaProductos._totalPages&&(ListaProductos._currentPage++,ListaProductos.Consultar())},PaginaAnterior:function(){ListaProductos._currentPage>1&&(ListaProductos._currentPage--,ListaProductos.Consultar())},PaginaInicio:function(){ListaProductos._totalPages>0&&ListaProductos._currentPage!==1&&(ListaProductos._currentPage=1,ListaProductos.Consultar())},PaginaFin:function(){ListaProductos._totalPages>0&&ListaProductos._currentPage!==ListaProductos._totalPages&&(ListaProductos._currentPage=ListaProductos._totalPages,ListaProductos.Consultar())},ActualizarPaginador:function(){$("#txtNumPage").unbind();$("#txtNumPage").on("keyup",function(n){if(n.keyCode===13){var t=parseInt($(this).val());ListaProductos.IrAPagina(t)}});$("#txtNumPage").on("blur",function(){var n=parseInt($(this).val());ListaProductos.IrAPagina(n)});$("#txtNumPage").ForceNumericOnly();$("#txtNumPage").attr("placeholder",ListaProductos._currentPage+" / "+ListaProductos._totalPages)},ApplyFilters:function(n){ListaProductos._currentFilters=n;ListaProductos._currentPage=1;ListaProductos.Consultar()},IrAPagina:function(n){n=parseInt(n);isNaN(n)||n<=0||n>ListaProductos._totalPages?$("#txtNumPage").val(""):(ListaProductos._currentPage=n,ListaProductos.Consultar())},Consultar:function(){var t=!1,n;$("#Destacados").length>0&&(t=$("#Destacados").val().toLowerCase()=="true");n=ListaProductos._currentFilters;n===null||n.length===0?(n=[],n.push("NONE"),$("#txtFiltros").val("")):$("#txtFiltros").val(n.length+" filtros aplicados");eCommerce.DoGET("ListaProductos","Get",{prodfilters:JSON.stringify(n),soloDestacados:t,itemsPerPage:ListaProductos._itemsPerPage,numPage:ListaProductos._currentPage},function(n){if(n=="SESION_FINALIZADA"){location.href="/eCommerce/Login?error=La%20sesión%20caducó.%20Vuelva%20a%20identificarse%20por%20favor";return}$(ListaProductos._domTableTBODY).html(n);ListaProductos._totalPages=parseInt(parseInt($("#RowsCount").val())/ListaProductos._itemsPerPage)+1;ListaProductos.ActualizarPaginador();$(".tblListaProductos .cantidad").change(function(){var n=parseFloat($(this).val());(isNaN(n)||n<0)&&$(this).val("0")});$(".tblListaProductos .cantidad").on("keyup",function(n){if(n.keyCode===13){var t=$(this).attr("articuloId");$(".tblListaProductos .btnAgregarCarrito[articuloId='"+t+"']").click()}});$(".tblListaProductos .btnAgregarCarrito").click(function(){var n=$(this).attr("articuloId"),i=parseFloat($(".porcentaje[articuloId='"+n+"']").text().replace("% ","").replace(",",".")),r=parseFloat($(".porcentajeIVA[articuloId='"+n+"']").text().replace("% ","").replace(",",".")),t=parseInt($(".cantidad[articuloId='"+n+"']").val()),u=ObtenerDeMoneda($(".precioUnitario[articuloId='"+n+"']").text().replace("¡","").replace("!","")).valor,f=ObtenerDeMoneda($(".precioUnitarioConDescuento[articuloId='"+n+"']").text().replace("¡","").replace("!","")).valor,e=ObtenerDeMoneda($(".precioUnitarioConDescuentoNeto[articuloId='"+n+"']").text().replace("¡","").replace("!","")).valor,o=$(".tienePVP[articuloId='"+n+"']").html()=="true";if(t==0){Mensajes.MostrarError("La cantidad no puede ser cero.");return}Carrito.AgregarItem(n,t,o,u,i,f,r,e,function(n){$(".cantidad[articuloId='"+n.articuloId+"']").val("0").blur();Mensajes.MostrarOK("Se agregó correctamente al carrito.");Carrito.ActualizarTotalizador(n)})});var t=$("#EsCatalogo").length>0&&$("#EsCatalogo").val()=="True";t&&$("[hidden-para-catalogo]").hide()},!0)},ObtenerFiltrosDelModal:function(){var n=[];return $(".txtFiltroField").filter(function(){return!!this.value}).each(function(t,i){var r=$(i).attr("query-operator").toUpperCase(),u=$(i).attr("query-field"),f=u+"??:??"+r+"??:??"+$(i).val();n.push(f)}),$(".chkFiltroField").filter(function(){return $(this).is("[send-only-if-checked]")?$(this).is(":checked"):!0}).each(function(t,i){var r=$(i).attr("query-operator").toUpperCase(),u=$(i).attr("query-field"),f=u+"??:??"+r+"??:??"+($(i).is(":checked")?"1":"0");n.push(f)}),n}};